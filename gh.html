<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Morse Code Mastery</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&family=Share+Tech+Mono&display=swap');
        
        :root {
            --primary-color: #3a86ff;
            --secondary-color: #8338ec;
            --background-color: #f8f9fa;
            --text-color: #212529;
            --accent-color: #ff006e;
            --success-color: #06d6a0;
            --warning-color: #ffd166;
            --danger-color: #ef476f;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            transition: background-color 0.3s ease;
        }
        
        .container {
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            padding: 2rem;
            max-width: 800px;
            width: 100%;
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        h1 {
            color: var(--primary-color);
            margin-bottom: 1rem;
            font-weight: 600;
            font-size: 2.5rem;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 1rem;
            font-size: 1rem;
            background-color: var(--background-color);
            padding: 0.5rem;
            border-radius: 10px;
        }
        
        .morse-code {
            font-size: 3rem;
            margin: 1.5rem 0;
            padding: 1.5rem;
            background-color: var(--background-color);
            border-radius: 10px;
            font-family: 'Share Tech Mono', monospace;
            position: relative;
            overflow: hidden;
            letter-spacing: 5px;
        }
        
        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        button {
            padding: 0.75rem 1rem;
            font-size: 1.2rem;
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            transition: all 0.3s;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 1px;
        }
        
        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        #result {
            font-weight: bold;
            margin-bottom: 1rem;
            min-height: 1.5em;
            color: var(--accent-color);
            font-size: 1.2rem;
        }
        
        #progress-bar {
            width: 100%;
            height: 10px;
            background-color: #e9ecef;
            border-radius: 5px;
            margin-bottom: 1rem;
            overflow: hidden;
        }
        
        #progress {
            width: 100%;
            height: 100%;
            background-color: var(--primary-color);
            border-radius: 5px;
            transition: width 0.5s linear;
        }
        
        .settings {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .settings button {
            background-color: transparent;
            color: var(--primary-color);
            border: 2px solid var(--primary-color);
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
        }
        
        .settings button:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .streak {
            font-size: 1.4rem;
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 1rem;
        }
        
        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 1.5rem;
            background-color: var(--background-color);
            padding: 1rem;
            border-radius: 10px;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-color);
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        .particle {
            position: absolute;
            background-color: var(--primary-color);
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
        }
        
        @media (max-width: 600px) {
            .options {
                grid-template-columns: 1fr;
            }
            .settings {
                flex-direction: column;
            }
            .container {
                padding: 1rem;
            }
            h1 {
                font-size: 2rem;
            }
            .morse-code {
                font-size: 2.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="fade-in">Morse Code Mastery</h1>
        <div class="game-info fade-in">
            <div id="score">Skor: 0</div>
            <div id="level">Level: 1</div>
            <div id="timer">Waktu: 30</div>
        </div>
        <div id="progress-bar"><div id="progress"></div></div>
        <div class="streak fade-in pulse" id="streak">Streak: 0</div>
        <div class="morse-code fade-in" id="morse-code"></div>
        <div class="options fade-in" id="options"></div>
        <div id="result"></div>
        <div class="settings fade-in">
            <button onclick="toggleDifficulty()">Kesulitan</button>
            <button onclick="toggleTheme()">Tema</button>
            <button onclick="showTutorial()">Tutorial</button>
            <button onclick="toggleSound()">Suara</button>
        </div>
        <div class="stats fade-in">
            <div class="stat-item">
                <div class="stat-value" id="total-correct">0</div>
                <div class="stat-label">Benar</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="total-wrong">0</div>
                <div class="stat-label">Salah</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="accuracy">0%</div>
                <div class="stat-label">Akurasi</div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js"></script>
    <script>
        const morseCode = {
            'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.', 'F': '..-.',
            'G': '--.', 'H': '....', 'I': '..', 'J': '.---', 'K': '-.-', 'L': '.-..',
            'M': '--', 'N': '-.', 'O': '---', 'P': '.--.', 'Q': '--.-', 'R': '.-.',
            'S': '...', 'T': '-', 'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-',
            'Y': '-.--', 'Z': '--..', '0': '-----', '1': '.----', '2': '..---',
            '3': '...--', '4': '....-', '5': '.....', '6': '-....', '7': '--...',
            '8': '---..', '9': '----.'
        };

        let gameState = {
            currentQuestion: '',
            score: 0,
            timer: null,
            timeLeft: 30,
            level: 1,
            streak: 0,
            difficulty: 'mudah',
            combo: 0,
            questionHistory: [],
            answerHistory: [],
            totalCorrect: 0,
            totalWrong: 0,
            soundEnabled: true,
            theme: 'light'
        };

        function getRandomKey(obj) {
            const keys = Object.keys(obj);
            return keys[Math.floor(Math.random() * keys.length)];
        }

        function generateOptions(correct) {
            const options = [correct];
            while (options.length < 4) {
                const randomOption = getRandomKey(morseCode);
                if (!options.includes(randomOption)) {
                    options.push(randomOption);
                }
            }
            return options.sort(() => Math.random() - 0.5);
        }

        function displayQuestion() {
            const morseCodeElement = document.getElementById('morse-code');
            const optionsElement = document.getElementById('options');

            do {
                gameState.currentQuestion = getRandomKey(morseCode);
            } while (gameState.questionHistory.length > 0 && gameState.currentQuestion === gameState.questionHistory[gameState.questionHistory.length - 1]);

            gameState.questionHistory.push(gameState.currentQuestion);
            if (gameState.questionHistory.length > 10) gameState.questionHistory.shift();

            morseCodeElement.textContent = morseCode[gameState.currentQuestion];
            morseCodeElement.classList.remove('fade-in');
            void morseCodeElement.offsetWidth;
            morseCodeElement.classList.add('fade-in');

            if (gameState.soundEnabled) {
                playMorseAudio(morseCode[gameState.currentQuestion]);
            }

            const options = generateOptions(gameState.currentQuestion);
            optionsElement.innerHTML = '';
            options.forEach(option => {
                const button = document.createElement('button');
                button.textContent = option;
                button.onclick = () => checkAnswer(option);
                button.classList.add('fade-in');
                optionsElement.appendChild(button);
            });

            startTimer();
        }

        function checkAnswer(answer) {
            const resultElement = document.getElementById('result');
            const scoreElement = document.getElementById('score');
            const streakElement = document.getElementById('streak');

            gameState.answerHistory.push({question: gameState.currentQuestion, userAnswer: answer, correct: answer === gameState.currentQuestion});
            if (gameState.answerHistory.length > 10) gameState.answerHistory.shift();

            if (answer === gameState.currentQuestion) {
                resultElement.textContent = 'Benar!';
                resultElement.style.color = 'var(--success-color)';
                gameState.combo++;
                const baseScore = Math.ceil(gameState.timeLeft / 3) * gameState.level;
                const comboBonus = Math.floor(gameState.combo / 3);
                gameState.score += baseScore + comboBonus;
                gameState.streak++;
                gameState.totalCorrect++;
                createParticles();
                if (gameState.streak % 5 === 0) {
                    gameState.level++;
                    document.getElementById('level').textContent = `Level: ${gameState.level}`;
                    showLevelUpAnimation();
                }
            } else {
                resultElement.textContent = `Salah. Jawaban yang benar adalah ${gameState.currentQuestion}.`;
                resultElement.style.color = 'var(--danger-color)';
                gameState.streak = 0;
                gameState.combo = 0;
                gameState.totalWrong++;
                showIncorrectAnimation();
            }

            scoreElement.textContent = `Skor: ${gameState.score}`;
            streakElement.textContent = `Streak: ${gameState.streak}`;
            clearInterval(gameState.timer);

            updateStats();

            setTimeout(() => {
                displayQuestion();
                resultElement.textContent = '';
            }, 1500);
        }

        function startTimer() {
            clearInterval(gameState.timer);
            gameState.timeLeft = gameState.difficulty === 'mudah' ? 30 : gameState.difficulty === 'sedang' ? 20 : 10;
            const timerElement = document.getElementById('timer');
            const progressElement = document.getElementById('progress');

            gameState.timer = setInterval(() => {
                gameState.timeLeft--;
                timerElement.textContent = `Waktu: ${gameState.timeLeft}`;
                progressElement.style.width = `${(gameState.timeLeft / (gameState.difficulty === 'mudah' ? 30 : gameState.difficulty === 'sedang' ? 20 : 10)) * 100}%`;

                if (gameState.timeLeft <= 5) {
                    timerElement.style.color = 'var(--danger-color)';
                } else {
                    timerElement.style.color = 'var(--text-color)';
                }

                if (gameState.timeLeft <= 0) {
                    clearInterval(gameState.timer);
                    checkAnswer('');
                }
            }, 1000);
        }

        function toggleDifficulty() {
            if (gameState.difficulty === 'mudah') {
                gameState.difficulty = 'sedang';
            } else if (gameState.difficulty === 'sedang') {
                gameState.difficulty = 'sulit';
            } else {
                gameState.difficulty = 'mudah';
            }
            showNotification(`Tingkat kesulitan: ${gameState.difficulty}`);
            displayQuestion();
        }

        function toggleTheme() {
            const root = document.documentElement;
            if (gameState.theme === 'light') {
                root.style.setProperty('--primary-color', '#06d6a0');
                root.style.setProperty('--secondary-color', '#118ab2');
                root.style.setProperty('--background-color', '#073b4c');
                root.style.setProperty('--text-color', '#ffd166');
                root.style.setProperty('--accent-color', '#ef476f');
                document.body.style.backgroundColor = '#073b4c';
                gameState.theme = 'dark';
            } else {
                root.style.setProperty('--primary-color', '#3a86ff');
                root.style.setProperty('--secondary-color', '#8338ec');
                root.style.setProperty('--background-color', '#f8f9fa');
                root.style.setProperty('--text-color', '#212529');
                root.style.setProperty('--accent-color', '#ff006e');
                document.body.style.backgroundColor = '#f8f9fa';
                gameState.theme = 'light';
            }
            showNotification(`Tema berubah ke ${gameState.theme}`);
        }

        function toggleSound() {
            gameState.soundEnabled = !gameState.soundEnabled;
            showNotification(gameState.soundEnabled ? 'Suara diaktifkan' : 'Suara dinonaktifkan');
        }

        function showNotification(message) {
            const notification = document.createElement('div');
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.backgroundColor = 'var(--primary-color)';
            notification.style.color = 'white';
            notification.style.padding = '10px 20px';
            notification.style.borderRadius = '5px';
            notification.style.zIndex = '1000';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.5s';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 500);
            }, 2000);
        }

        function createParticles() {
            const particlesContainer = document.querySelector('.container');
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                const size = Math.random() * 8 + 4;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.setProperty('--primary-color', getComputedStyle(document.documentElement).getPropertyValue('--primary-color'));
                particlesContainer.appendChild(particle);

                anime({
                    targets: particle,
                    opacity: [0, 1, 0],
                    translateX: anime.random(-50, 50),
                    translateY: anime.random(-50, 50),
                    scale: [1, 0],
                    easing: 'easeOutExpo',
                    duration: 1000,
                    complete: function() {
                        particlesContainer.removeChild(particle);
                    }
                });
            }
        }

        function showLevelUpAnimation() {
            const levelElement = document.getElementById('level');
            anime({
                targets: levelElement,
                scale: [1, 1.2, 1],
                rotate: '1turn',
                duration: 1000,
                easing: 'easeInOutQuad'
            });
            showNotification('Level Up!');
        }

        function showIncorrectAnimation() {
            const containerElement = document.querySelector('.container');
            anime({
                targets: containerElement,
                translateX: [
                    { value: -10, duration: 100, easing: 'easeInOutQuad' },
                    { value: 10, duration: 100, easing: 'easeInOutQuad' },
                    { value: -10, duration: 100, easing: 'easeInOutQuad' },
                    { value: 10, duration: 100, easing: 'easeInOutQuad' },
                    { value: 0, duration: 100, easing: 'easeInOutQuad' }
                ]
            });
        }

        function showTutorial() {
            const steps = [
                "Selamat datang di Morse Code Mastery!",
                "Anda akan melihat kode Morse di layar.",
                "Pilih huruf atau angka yang sesuai dengan kode tersebut.",
                "Jawab secepat mungkin untuk skor lebih tinggi!",
                "Streak akan meningkatkan level dan skor Anda.",
                "Ubah tingkat kesulitan atau tema sesuai keinginan.",
                "Aktifkan atau nonaktifkan suara sesuai preferensi Anda.",
                "Selamat belajar dan bersenang-senang!"
            ];

            let currentStep = 0;

            function showStep() {
                if (currentStep < steps.length) {
                    showNotification(steps[currentStep]);
                    currentStep++;
                    setTimeout(showStep, 3000);
                }
            }

            showStep();
        }

        function updateStats() {
            const totalCorrectElement = document.getElementById('total-correct');
            const totalWrongElement = document.getElementById('total-wrong');
            const accuracyElement = document.getElementById('accuracy');

            totalCorrectElement.textContent = gameState.totalCorrect;
            totalWrongElement.textContent = gameState.totalWrong;

            const totalAttempts = gameState.totalCorrect + gameState.totalWrong;
            const accuracy = totalAttempts > 0 ? (gameState.totalCorrect / totalAttempts * 100).toFixed(1) : 0;
            accuracyElement.textContent = `${accuracy}%`;

            anime({
                targets: [totalCorrectElement, totalWrongElement, accuracyElement],
                scale: [1, 1.1, 1],
                duration: 300,
                easing: 'easeInOutQuad'
            });
        }

        function playMorseAudio(morseCode) {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const dotDuration = 60; // ms
            const dashDuration = dotDuration * 3;
            const pauseDuration = dotDuration;

            let startTime = audioContext.currentTime;

            morseCode.split('').forEach(symbol => {
                const oscillator = audioContext.createOscillator();
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(600, startTime);

                const gainNode = audioContext.createGain();
                gainNode.gain.setValueAtTime(0, startTime);
                gainNode.gain.linearRampToValueAtTime(1, startTime + 0.01);

                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);

                const duration = symbol === '.' ? dotDuration : dashDuration;
                oscillator.start(startTime);
                oscillator.stop(startTime + duration / 1000);

                startTime += (duration + pauseDuration) / 1000;
            });
        }

        function initializeGame() {
            displayQuestion();
            updateStats();
        }

        // Memulai permainan
        initializeGame();

        // Event listener untuk keydown
        document.addEventListener('keydown', function(event) {
            const key = event.key.toUpperCase();
            if (morseCode.hasOwnProperty(key)) {
                const buttons = document.querySelectorAll('.options button');
                buttons.forEach(button => {
                    if (button.textContent === key) {
                        button.click();
                    }
                });
            }
        });

    </script>
</body>
</html>